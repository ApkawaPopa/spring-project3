# SpringProject3 — REST API для метеосенсора

Репозиторий содержит реализацию простого REST API сервиса для приёма измерений от «сенсора» (значение + флаг дождя), сохранения их в базу данных и получения агрегированных данных. Проект включает HTTP-эндпоинты для регистрации сенсоров, добавления измерений, получения всех измерений и подсчёта дней с дождём.

---

# Коротко о реализованном

* Регистрация сенсора (уникальное имя).
* Приём измерений от сенсора: `value` (число), `raining` (boolean) и ссылка на сенсор.
* Валидация входящих DTO (диапазоны, обязательные поля, длина имени).
* Сохранение сущностей в PostgreSQL через Spring Data JPA / Hibernate.
* Подсчёт количества уникальных дней, в которые были измерения с `raining = true`.
* Простейший клиент-имитатор `SensorImitator`, который регистрирует сенсор, отправляет множество случайных измерений и получает их обратно.
* Минимальная конфигурация безопасности: публичный доступ к нужным эндпоинтам, отключение сессий/CSRF для простоты тестирования.

---

# Технологии

* Java + Spring Boot
* Spring Web (REST)
* Spring Data JPA (Hibernate)
* PostgreSQL
* Jakarta Validation (`@NotNull`, `@Min`, `@Max`, `@NotBlank`, `@Valid`, `@Length`)
* ModelMapper (маппинг DTO ↔ entity)
* Spring Security (базовая конфигурация доступа к эндпоинтам)
* RestTemplate (клиент-имитатор)
* Maven (сборка)

---

# Эндпоинты API

> Все запросы предполагают Content-Type: `application/json` для POST.

## 1) Регистрация сенсора

**POST** `/sensors/registration`

**Тело (пример):**

```json
{
  "name": "firstSensor"
}
```

**Валидация:**

* `name` — обязательное, не пустое, длина от 3 до 30 символов.
* Если сенсор с таким именем уже существует — возвращается ошибка.

**Ответы:**

* `201 Created` — успешно.
* `400 Bad Request` — при ошибке валидации или если имя уже занято. Тело ошибки:

  ```json
  {
    "message": "описание ошибки",
    "timestamp": 1234567890
  }
  ```

---

## 2) Добавление измерения

**POST** `/measurements/add`

**Тело (пример):**

```json
{
  "value": 12.5,
  "raining": true,
  "sensor": {
    "name": "firstSensor"
  }
}
```

**Валидация:**

* `value` — обязательное, число в диапазоне `[-100, 100]`.
* `raining` — обязательное boolean.
* `sensor` — обязательный объект; поле `name` сенсора должно существовать в БД.

**Поведение:**

* При сохранении сервер сам проставляет `createdAt = now()`.
* Если сенсор не найден — `400 Bad Request` с описанием ошибки.

**Ответы:**

* `201 Created` — успешно.
* `400 Bad Request` — при ошибках валидации или отсутствии сенсора.

---

## 3) Получение всех измерений

**GET** `/measurements`

**Описание:** возвращает список измерений в формате `MeasurementDTO`:

```json
[
  {
    "value": 12.5,
    "raining": true,
    "sensor": { "name": "firstSensor" }
  },
  ...
]
```

**Ответ:** `200 OK` с массивом измерений.

---

## 4) Количество дождливых дней

**GET** `/measurements/rainyDaysCount`

**Описание:** возвращает целое число — количество уникальных дней, в которые были измерения с `raining = true`. Подсчёт сделан нативным SQL-запросом в репозитории.

**Ответ (пример):**

```json
3
```